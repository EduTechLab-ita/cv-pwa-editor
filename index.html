<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CV PWA Editor v5.2 - EduTechLab Italia</title>
  <meta name="description" content="Editor professionale per Curriculum Vitae Europass con funzionalit√† offline - Sviluppato da EduTechLab Italia">
  
  <!-- PWA Meta -->
  <meta name="theme-color" content="#003d7a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="CV Editor">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="./icon-192.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./icon-192.png">
  <link rel="shortcut icon" href="./icon-192.png">
  <link rel="apple-touch-icon" href="./icon-192.png">
  
  <style>
    /* === CSS DESIGN UPGRADE v5.1 === */
    
    /* Reset e Base */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f1f5f9;
    }
    
    /* Banner Aggiornamento Versione */
    .version-banner {
      background: linear-gradient(90deg, #16a34a, #22c55e);
      color: white;
      padding: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 1001;
      display: none;
    }
    
    .version-banner.show {
      display: block;
    }
    
    .version-banner-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .version-banner-close {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background 0.2s;
    }
    
    .version-banner-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    /* Header App */
    .app-header {
      background: white;
      border-bottom: 1px solid #e2e8f0;
      padding: 16px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .app-header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .app-logo-section {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .app-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .europass-logo {
      width: 60px;
      height: 40px;
      background: #003d7a;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-weight: bold;
      font-size: 0.8rem;
    }
    
    .app-title {
      color: #003d7a;
      font-size: 1.5rem;
      font-weight: bold;
      margin: 0;
    }
    
    .app-version {
      background: #003d7a;
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .app-status {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #64748b;
      font-size: 0.875rem;
    }
    
    .online-indicator {
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .header-btn {
      padding: 8px 16px;
      border: 1px solid #e2e8f0;
      background: white;
      color: #374151;
      border-radius: 6px;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .header-btn:hover {
      background: #f8fafc;
      border-color: #cbd5e1;
    }
    
    .header-btn.primary {
      background: #003d7a;
      color: white;
      border-color: #003d7a;
    }
    
    .header-btn.primary:hover {
      background: #002c5f;
    }
    
    .header-btn.success {
      background: #16a34a;
      color: white;
      border-color: #16a34a;
    }
    
    .header-btn.success:hover {
      background: #15803d;
    }
    
    /* Main Layout */
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    @media (min-width: 768px) {
      .main-container {
        grid-template-columns: 280px 1fr;
      }
    }
    
    /* Sidebar */
    .sidebar {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      height: fit-content;
      overflow: hidden;
    }
    
    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid #e2e8f0;
      background: #f8fafc;
    }
    
    .sidebar-title {
      color: #003d7a;
      font-weight: 600;
      font-size: 1rem;
      margin: 0;
    }
    
    .sidebar-nav {
      padding: 12px 0;
    }
    
    .nav-section {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      padding: 12px 20px;
      background: none;
      border: none;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.875rem;
      color: #374151;
      border-left: 3px solid transparent;
    }
    
    .nav-section:hover {
      background: #f1f5f9;
    }
    
    .nav-section.active {
      background: #eff6ff;
      color: #003d7a;
      border-left-color: #003d7a;
      font-weight: 500;
    }
    
    .nav-icon {
      font-size: 1rem;
      width: 20px;
      text-align: center;
    }
    
    /* Main Content */
    .main-content {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .content-header {
      padding: 20px 30px;
      border-bottom: 1px solid #e2e8f0;
      background: #f8fafc;
    }
    
    .section-title {
      color: #003d7a;
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .content-body {
      padding: 30px;
    }
    
    /* Form Styling */
    .section {
      display: none;
    }
    
    .section.active {
      display: block;
      animation: fadeIn 0.3s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    @media (min-width: 600px) {
      .form-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    
    .form-label {
      font-weight: 500;
      color: #374151;
      font-size: 0.875rem;
    }
    
    .form-label.required::after {
      content: " *";
      color: #ef4444;
    }
    
    /* Input Styling Critico */
    .form-input,
    .form-textarea {
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.875rem;
      font-family: inherit;
      transition: all 0.2s;
      background: white;
    }
    
    .form-input:focus,
    .form-textarea:focus {
      outline: none;
      border-color: #003d7a;
      box-shadow: 0 0 0 3px rgba(0, 61, 122, 0.1);
    }
    
    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .form-input::placeholder,
    .form-textarea::placeholder {
      color: #9ca3af;
    }
    
    /* Save Indicator */
    .save-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #16a34a;
      color: white;
      padding: 10px 16px;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 500;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
    }
    
    .save-indicator.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* CV Preview */
    .cv-preview {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background: white;
      min-height: 500px;
      padding: 40px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .cv-header {
      text-align: center;
      border-bottom: 2px solid #003d7a;
      padding-bottom: 20px;
      margin-bottom: 30px;
    }
    
    .cv-name {
      color: #003d7a;
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 10px;
    }
    
    .cv-contact-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 8px;
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 10px;
    }
    
    .cv-contact-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .cv-address {
      color: #6b7280;
      font-size: 0.875rem;
    }
    
    .cv-section {
      margin-bottom: 30px;
    }
    
    .cv-section-title {
      color: #003d7a;
      font-size: 1.25rem;
      font-weight: 600;
      border-bottom: 1px solid #d1d5db;
      padding-bottom: 8px;
      margin-bottom: 15px;
    }
    
    .cv-content {
      line-height: 1.6;
      color: #374151;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #9ca3af;
      background: #f9fafb;
      border-radius: 8px;
    }
    
    .empty-state h3 {
      font-size: 1.125rem;
      margin-bottom: 8px;
      color: #6b7280;
    }
    
    /* Footer */
    .app-footer {
      text-align: center;
      padding: 20px;
      color: #6b7280;
      font-size: 0.875rem;
      border-top: 1px solid #e2e8f0;
      margin-top: 40px;
      background: white;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    
    .footer-link {
      color: #003d7a;
      text-decoration: none;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background 0.2s;
    }
    
    .footer-link:hover {
      background: #f1f5f9;
    }
    
    /* Photo Upload Styles */
    .photo-upload-container {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }
    
    .photo-upload-area {
      border: 2px dashed #d1d5db;
      border-radius: 8px;
      padding: 30px 20px;
      text-align: center;
      transition: all 0.2s;
      background: #f9fafb;
      min-width: 200px;
    }
    
    .photo-upload-area:hover {
      border-color: #003d7a;
      background: #f1f5f9;
    }
    
    .photo-upload-area.dragover {
      border-color: #003d7a;
      background: #eff6ff;
      transform: scale(1.02);
    }
    
    .photo-upload-content p {
      margin: 8px 0;
      font-size: 0.875rem;
      color: #374151;
    }
    
    .photo-preview-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
    }
    
    .photo-preview {
      width: 120px;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .photo-controls {
      display: flex;
      gap: 8px;
    }
    
    .photo-btn {
      padding: 6px 12px;
      border: 1px solid #d1d5db;
      background: white;
      color: #374151;
      border-radius: 4px;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .photo-btn:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
    }
    
    .cv-profile-photo {
      width: 3.5cm;
      height: 4.5cm;
      object-fit: cover;
      border-radius: 6px;
      float: right;
      margin-left: 20px;
      margin-bottom: 15px;
      border: 2px solid #e5e7eb;
    }
    
    /* Dynamic Lists */
    .dynamic-list {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #f9fafb;
    }
    
    .list-item {
      padding: 20px;
      border-bottom: 1px solid #e5e7eb;
      background: white;
      position: relative;
    }
    
    .list-item:last-child {
      border-bottom: none;
    }
    
    .list-item-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .list-item-title {
      font-weight: 600;
      color: #003d7a;
      flex: 1;
    }
    
    .list-item-controls {
      display: flex;
      gap: 8px;
    }
    
    .list-btn {
      padding: 4px 8px;
      border: 1px solid #d1d5db;
      background: white;
      color: #374151;
      border-radius: 4px;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .list-btn:hover {
      background: #f3f4f6;
    }
    
    .list-btn.danger:hover {
      background: #fef2f2;
      border-color: #f87171;
      color: #dc2626;
    }
    
    .add-item-btn {
      width: 100%;
      padding: 15px;
      border: 2px dashed #d1d5db;
      background: #f9fafb;
      color: #6b7280;
      border-radius: 8px;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 15px;
    }
    
    .add-item-btn:hover {
      border-color: #003d7a;
      color: #003d7a;
      background: #f1f5f9;
    }
    
    /* Skills and ratings */
    .skill-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px 0;
      border-bottom: 1px solid #f1f5f9;
    }
    
    .skill-item:last-child {
      border-bottom: none;
    }
    
    .skill-name {
      flex: 1;
      min-width: 0;
    }
    
    .skill-level {
      display: flex;
      gap: 4px;
      align-items: center;
    }
    
    .level-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid #d1d5db;
      transition: all 0.2s;
    }
    
    .level-dot.active {
      background: #003d7a;
      border-color: #003d7a;
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }
    
    /* Responsive */
    @media (max-width: 767px) {
      .app-header-content {
        flex-direction: column;
        text-align: center;
        gap: 12px;
      }
      
      .header-actions {
        width: 100%;
        justify-content: center;
      }
      
      .main-container {
        padding: 15px;
      }
      
      .content-body {
        padding: 20px;
      }
      
      .cv-preview {
        padding: 20px;
      }
    }

    /* === Settings Tabs Styles === */
    .settings-tabs {
      display: flex;
      border-bottom: 2px solid #e5e7eb;
      margin-bottom: 24px;
      overflow-x: auto;
    }

    .settings-tab-btn {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border: none;
      background: none;
      color: #6b7280;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      white-space: nowrap;
      transition: all 0.2s ease;
    }

    .settings-tab-btn:hover {
      color: #374151;
      background: #f9fafb;
    }

    .settings-tab-btn.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
      background: #eff6ff;
    }

    .settings-tab-content {
      display: none;
    }

    .settings-tab-content.active {
      display: block;
    }

    .template-card {
      transition: all 0.2s ease;
    }

    .template-card:hover {
      border-color: #9ca3af !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .template-card.active {
      border-color: #2563eb !important;
      background: #eff6ff !important;
    }

    /* === CV Base Styles (dalla v4.7) === */
    
    /* CV Foto Profile - FOTO TONDA */
    .cv-profile-photo {
      width: 120px;
      height: 120px;
      border-radius: 50% !important;
      object-fit: cover;
      border: 3px solid #003d7a;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      position: absolute;
      top: 0;
      right: 0;
    }
    
    /* Stili base CV */
    .cv-title {
      text-align: center;
      font-size: 1.8em;
      font-weight: 300;
      color: #003d7a;
      margin: 30px 0 20px 0;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .page-bar {
      width: calc(100% + 80px);
      margin-left: -40px;
      margin-right: -40px;
      height: 8px;
      background-color: #003d7a;
      margin-bottom: 30px;
    }
    
    .europass-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .cv-experience-item, .cv-education-item, .cv-formatore-item {
      margin-bottom: 25px;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #003d7a;
    }
    
    .cv-experience-date, .cv-education-date, .cv-formatore-date {
      font-size: 0.9em;
      font-style: italic;
      color: #666;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .cv-experience-item h4, .cv-education-item h4, .cv-formatore-item h4 {
      font-weight: bold;
      font-size: 1.1em;
      color: #003d7a;
      margin-bottom: 5px;
    }
    
    .cv-experience-item h5, .cv-education-item h5, .cv-formatore-item h5 {
      font-weight: normal;
      color: #666;
      margin-bottom: 10px;
    }
    
    .cv-skills-category {
      background: #0066cc;
      color: white;
      padding: 8px 16px;
      margin: 20px 0 15px 0;
      font-size: 1.1em;
      font-weight: 500;
      border-radius: 4px;
    }

    /* === Template Styles === */
    
    /* TEMPLATE MODERNO */
    .cv-preview.modern-template {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
      color: #1e293b;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      border-left: 8px solid #3b82f6;
    }

    .modern-template .cv-header {
      background: linear-gradient(135deg, #3b82f6, #1e40af);
      border-radius: 15px;
      margin-bottom: 30px;
      color: white;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      padding: 25px;
    }
    
    .modern-template .cv-profile-photo {
      border: 3px solid #3b82f6;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    .modern-template .cv-title {
      font-size: 3em;
      font-weight: 300;
      text-align: center;
      margin: 30px 0;
      color: #1e40af;
      text-shadow: none;
    }
    
    .modern-template .page-bar {
      background: linear-gradient(135deg, #3b82f6, #1e40af);
    }

    .modern-template .cv-name {
      font-size: 2.5em;
      font-weight: 300;
      text-align: center;
      margin: 20px 0;
      color: white;
      text-shadow: none;
    }

    .modern-template .cv-section-title {
      color: white;
      background: linear-gradient(135deg, #3b82f6, #1e40af);
      padding: 15px 20px;
      border-radius: 8px;
      margin: 30px 0 20px 0;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
      border-bottom: none;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
    }

    .modern-template .cv-contact-item {
      color: white;
      background: rgba(255,255,255,0.2);
      padding: 8px 12px;
      margin: 4px 0;
      border-radius: 6px;
      border-left: 3px solid rgba(255,255,255,0.5);
    }

    .modern-template .cv-experience-item,
    .modern-template .cv-education-item,
    .modern-template .cv-formatore-item {
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      color: #334155;
    }

    .modern-template .cv-experience-item h4,
    .modern-template .cv-experience-item h5,
    .modern-template .cv-education-item h4,
    .modern-template .cv-formatore-item h4 {
      color: #1e293b;
    }

    .modern-template .cv-experience-date,
    .modern-template .cv-education-date,
    .modern-template .cv-formatore-date {
      color: #3b82f6;
      font-weight: 500;
    }

    .modern-template .cv-skills-category {
      background: rgba(255,255,255,0.9);
      border: 1px solid #e2e8f0;
      border-left: 4px solid #3b82f6;
      color: #334155;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .modern-template .cv-skills-title {
      color: #1e293b;
      font-weight: 600;
    }

    .modern-template .cv-address {
      color: rgba(255,255,255,0.9);
    }

    /* Default Europass mantiene gli stili esistenti */
    .cv-preview:not(.modern-template) {
      /* Stili Europass di default gi√† definiti sopra */
    }
    
  </style>
</head>
<body>
  
  <!-- Banner Aggiornamento Versione -->
  <div class="version-banner" id="versionBanner">
    <div class="version-banner-content">
      <span>üéâ</span>
      <span><strong>Aggiornato alla versione 5.2!</strong> Nuove funzionalit√† v4.7: Formatore, Competenze DigiCompEU, Upload Foto</span>
    </div>
    <button class="version-banner-close" onclick="closeVersionBanner()">√ó</button>
  </div>
  
  <!-- Header App -->
  <header class="app-header">
    <div class="app-header-content">
      <div class="app-logo-section">
        <div class="app-logo">
          <img src="./CV-EUropass.png" alt="Europass" class="europass-logo-img" style="height: 40px; width: auto;">
          <div>
            <h1 class="app-title">CV PWA Editor</h1>
            <span class="app-version">v5.2</span>
          </div>
        </div>
        
        <div class="app-status">
          <div class="online-indicator"></div>
          <span>Online</span>
          <span>‚Ä¢</span>
          <span>Agg. 11/08/2025</span>
        </div>
      </div>
      
      <div class="header-actions">
        <button class="header-btn" onclick="switchSection('preview')">
          üëÅÔ∏è Anteprima
        </button>
        <button class="header-btn success" onclick="printCV()">
          üìÑ Stampa PDF
        </button>
      </div>
    </div>
  </header>
  
  <!-- Main Container -->
  <div class="main-container">
    
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2 class="sidebar-title">Sezioni</h2>
      </div>
      
      <nav class="sidebar-nav">
        <button class="nav-section active" data-section="personal" onclick="switchSection('personal')">
          <span class="nav-icon">üë§</span>
          Info Personali
        </button>
        <button class="nav-section" data-section="profile" onclick="switchSection('profile')">
          <span class="nav-icon">üìù</span>
          Profilo
        </button>
        <button class="nav-section" data-section="experience" onclick="switchSection('experience')">
          <span class="nav-icon">üíº</span>
          Esperienza
        </button>
        <button class="nav-section" data-section="education" onclick="switchSection('education')">
          <span class="nav-icon">üéì</span>
          Formazione
        </button>
        <button class="nav-section" data-section="formatore" onclick="switchSection('formatore')">
          <span class="nav-icon">üéØ</span>
          Formatore
        </button>
        <button class="nav-section" data-section="skills" onclick="switchSection('skills')">
          <span class="nav-icon">‚ö°</span>
          Competenze
        </button>
        <button class="nav-section" data-section="languages" onclick="switchSection('languages')">
          <span class="nav-icon">üåç</span>
          Lingue
        </button>
        <button class="nav-section" data-section="publications" onclick="switchSection('publications')">
          <span class="nav-icon">üìö</span>
          Pubblicazioni
        </button>
        <button class="nav-section" data-section="other" onclick="switchSection('other')">
          <span class="nav-icon">‚ù§Ô∏è</span>
          Altre Capacit√†
        </button>
        <button class="nav-section" data-section="settings" onclick="switchSection('settings')">
          <span class="nav-icon">‚öôÔ∏è</span>
          Impostazioni
        </button>
        <button class="nav-section" data-section="preview" onclick="switchSection('preview')">
          <span class="nav-icon">üëÅÔ∏è</span>
          Anteprima
        </button>
      </nav>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
      
      <!-- Info Personali -->
      <div class="section active" id="personal">
        <div class="content-header">
          <h2 class="section-title">
            <span>üë§</span>
            Informazioni Personali
          </h2>
        </div>
        
        <div class="content-body">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label required" for="fullName">Nome Completo</label>
              <input 
                type="text" 
                id="fullName" 
                class="form-input"
                placeholder="Il tuo nome completo"
              >
            </div>
            
            <div class="form-group">
              <label class="form-label" for="nationality">Nazionalit√†</label>
              <input 
                type="text" 
                id="nationality" 
                class="form-input"
                placeholder="Es. Italiana"
                value="Italiana"
              >
            </div>
            
            <div class="form-group">
              <label class="form-label" for="birthDate">Data di Nascita</label>
              <input 
                type="text" 
                id="birthDate" 
                class="form-input"
                placeholder="GG/MM/AAAA"
              >
            </div>
            
            <div class="form-group">
              <label class="form-label" for="phone">Telefono</label>
              <input 
                type="tel" 
                id="phone" 
                class="form-input"
                placeholder="(+39) 123 456 7890"
              >
            </div>
            
            <div class="form-group">
              <label class="form-label required" for="email">Email</label>
              <input 
                type="email" 
                id="email" 
                class="form-input"
                placeholder="tua@email.com"
              >
            </div>
            
            <div class="form-group full-width">
              <label class="form-label" for="address">Indirizzo</label>
              <input 
                type="text" 
                id="address" 
                class="form-input"
                placeholder="Via Esempio 123, 12345 Citt√† (Prov)"
              >
            </div>
            
            <div class="form-group full-width">
              <label class="form-label" for="website">Sito Web (opzionale)</label>
              <input 
                type="text" 
                id="website" 
                class="form-input"
                placeholder="https://tuosito.com"
              >
            </div>
            
            <!-- Upload Foto Profilo -->
            <div class="form-group full-width">
              <label class="form-label">Foto Profilo (opzionale)</label>
              <div class="photo-upload-container">
                <div class="photo-upload-area" id="photoUpload">
                  <div class="photo-upload-content">
                    <span style="font-size: 2rem;">üì∑</span>
                    <p><strong>Trascina qui la tua foto</strong></p>
                    <p>oppure <span style="color: #003d7a; cursor: pointer; text-decoration: underline;" onclick="document.getElementById('photoInput').click()">clicca per selezionare</span></p>
                    <p style="font-size: 0.75rem; color: #6b7280;">JPG, PNG (max 2MB)</p>
                  </div>
                  <input type="file" id="photoInput" accept="image/*" style="display: none;">
                </div>
                
                <div class="photo-preview-container" id="photoPreview" style="display: none;">
                  <img id="photoImg" class="photo-preview" alt="Anteprima foto">
                  <div class="photo-controls">
                    <button type="button" class="photo-btn" onclick="removePhoto()">üóëÔ∏è Rimuovi</button>
                    <button type="button" class="photo-btn" onclick="document.getElementById('photoInput').click()">üîÑ Cambia</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Profilo -->
      <div class="section" id="profile">
        <div class="content-header">
          <h2 class="section-title">
            <span>üìù</span>
            Profilo Professionale
          </h2>
        </div>
        
        <div class="content-body">
          <div class="form-group">
            <label class="form-label" for="profileText">Descrizione del tuo profilo professionale</label>
            <textarea 
              id="profileText" 
              class="form-textarea"
              placeholder="Descrivi qui il tuo profilo professionale, le tue competenze principali e gli obiettivi di carriera. Questo campo apparir√† come prima sezione del tuo CV Europass."
              style="min-height: 120px;"
            ></textarea>
          </div>
        </div>
      </div>
      
      <!-- Esperienza Lavorativa -->
      <div class="section" id="experience">
        <div class="content-header">
          <h2 class="section-title">
            <span>üíº</span>
            Esperienza Lavorativa
          </h2>
        </div>
        
        <div class="content-body">
          <div id="experienceList" class="dynamic-list">
            <!-- Le esperienze verranno generate dinamicamente -->
          </div>
          
          <button class="add-item-btn" onclick="addExperience()">
            <span>‚ûï</span>
            Aggiungi Esperienza
          </button>
        </div>
      </div>
      
      <!-- Formazione -->
      <div class="section" id="education">
        <div class="content-header">
          <h2 class="section-title">
            <span>üéì</span>
            Istruzione e Formazione
          </h2>
        </div>
        
        <div class="content-body">
          <div id="educationList" class="dynamic-list">
            <!-- La formazione verr√† generata dinamicamente -->
          </div>
          
          <button class="add-item-btn" onclick="addEducation()">
            <span>‚ûï</span>
            Aggiungi Formazione
          </button>
        </div>
      </div>
      
      <!-- Formatore -->
      <div class="section" id="formatore">
        <div class="content-header">
          <h2 class="section-title">
            <span>üéØ</span>
            Esperienza come Formatore
          </h2>
        </div>
        
        <div class="content-body">
          <div id="formatoreList" class="dynamic-list">
            <!-- Le attivit√† formative verranno generate dinamicamente -->
          </div>
          
          <button class="add-item-btn" onclick="addFormatore()">
            <span>‚ûï</span>
            Aggiungi Attivit√† Formativa
          </button>
        </div>
      </div>
      
      <!-- Competenze -->
      <div class="section" id="skills">
        <div class="content-header">
          <h2 class="section-title">
            <span>‚ö°</span>
            Competenze
          </h2>
        </div>
        
        <div class="content-body" style="max-width: none;">
          <!-- Competenze Specialistiche -->
          <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 24px; margin-bottom: 24px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
              <span style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.75rem;">‚≠ê Specialistiche</span>
              <h4 style="font-weight: 600; color: #003d7a; margin: 0;">Competenze del Tuo Settore</h4>
            </div>
            <div class="form-group">
              <label class="form-label" for="aiSkills">Competenze Specialistiche</label>
              <textarea 
                id="aiSkills" 
                class="form-textarea"
                placeholder="Descrivi qui le tue competenze specialistiche, certificazioni, e aree di expertise specifiche del tuo settore professionale."
                style="min-height: 100px;"
              ></textarea>
            </div>
          </div>

          <!-- Competenze Digitali -->
          <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 24px; margin-bottom: 24px;">
            <h4 style="font-weight: 600; color: #003d7a; margin-bottom: 16px;">üìä Competenze Digitali</h4>
            
            <!-- Campo Generico sempre presente -->
            <div class="form-group" style="margin-bottom: 20px;">
              <label class="form-label" for="digitalSkillsGeneric">Competenze Digitali Generali</label>
              <textarea 
                id="digitalSkillsGeneric" 
                class="form-textarea"
                placeholder="Descrivi qui le tue competenze digitali generali, software utilizzati, piattaforme conosciute e livello di utilizzo."
                style="min-height: 120px;"
              ></textarea>
            </div>

            <!-- Toggle DigiCompEU -->
            <div style="margin-bottom: 20px;">
              <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                <input type="checkbox" id="useDigiCompEU" style="width: 18px; height: 18px;">
                <span style="font-weight: 500; color: #374151;">Utilizza il Framework DigiCompEU (Competenze Digitali Europee)</span>
              </label>
              <p style="font-size: 0.875rem; color: #6b7280; margin-top: 4px; margin-left: 30px;">
                Attiva per mostrare le competenze secondo il framework europeo DigComp 2.1
              </p>
            </div>

            <!-- Sezione DigiCompEU (nascosta di default) -->
            <div id="digiCompSection" style="display: none; margin-top: 20px;">
              <p style="font-size: 0.875rem; color: #1d4ed8; margin-bottom: 12px;">üìã Competenze DigiCompEU (Framework Europeo):</p>
              <div id="digiCompItems" style="display: grid; gap: 12px;">
                <!-- Le competenze verranno generate dinamicamente -->
              </div>
            </div>
          </div>

          <!-- Piattaforme e Software -->
          <div class="form-group full-width">
            <label class="form-label" for="platforms">Piattaforme e Software</label>
            <textarea 
              id="platforms" 
              class="form-textarea"
              placeholder="Microsoft Office, Google Workspace, Adobe Creative Suite, CRM, LMS, etc."
              style="min-height: 80px;"
            ></textarea>
          </div>
        </div>
      </div>
      
      <!-- Lingue -->
      <div class="section" id="languages">
        <div class="content-header">
          <h2 class="section-title">
            <span>üåç</span>
            Lingue
          </h2>
        </div>
        
        <div class="content-body">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label" for="motherTongue">Madrelingua</label>
              <input 
                type="text" 
                id="motherTongue" 
                class="form-input"
                placeholder="Es. Italiano"
                value="Italiano"
              >
            </div>
            
            <div class="form-group">
              <label class="form-label" for="motherTongueLevel">Livello</label>
              <select id="motherTongueLevel" class="form-input">
                <option value="C2">C2 - Madrelingua</option>
              </select>
            </div>
          </div>
          
          <h4 style="margin: 30px 0 15px 0; color: #003d7a;">Altre Lingue</h4>
          <div id="languagesList" class="dynamic-list">
            <!-- Le lingue verranno generate dinamicamente -->
          </div>
          
          <button class="add-item-btn" onclick="addLanguage()">
            <span>‚ûï</span>
            Aggiungi Lingua
          </button>
        </div>
      </div>
      
      <!-- Pubblicazioni -->
      <div class="section" id="publications">
        <div class="content-header">
          <h2 class="section-title">
            <span>üìö</span>
            Pubblicazioni
          </h2>
        </div>
        
        <div class="content-body">
          <div id="publicationsList" class="dynamic-list">
            <!-- Le pubblicazioni verranno generate dinamicamente -->
          </div>
          
          <button class="add-item-btn" onclick="addPublication()">
            <span>‚ûï</span>
            Aggiungi Pubblicazione
          </button>
        </div>
      </div>
      
      <!-- Altre Informazioni -->
      <div class="section" id="other">
        <div class="content-header">
          <h2 class="section-title">
            <span>‚ú®</span>
            Altre Informazioni
          </h2>
        </div>
        
        <div class="content-body">
          <div class="form-group">
            <label class="form-label" for="otherSkills">Altre capacit√† e competenze</label>
            <textarea 
              id="otherSkills" 
              class="form-textarea"
              placeholder="Soft skills, hobby, interessi, attivit√† extracurriculari, premi, certificazioni, patenti, etc."
              style="min-height: 120px;"
            ></textarea>
          </div>
        </div>
      </div>
      
      <!-- Impostazioni Avanzate -->
      <div class="section" id="settings">
        <div class="content-header">
          <h2 class="section-title">
            <span>‚öôÔ∏è</span>
            Impostazioni Avanzate
          </h2>
        </div>
        
        <div class="content-body">
          <!-- Tab Navigation -->
          <div class="settings-tabs" style="display: flex; border-bottom: 2px solid #e5e7eb; margin-bottom: 24px;">
            <button class="settings-tab-btn active" data-tab="export" onclick="switchSettingsTab('export')">
              <span style="margin-right: 8px;">‚¨áÔ∏è</span>
              Export & Condivisione
            </button>
            <button class="settings-tab-btn" data-tab="privacy" onclick="switchSettingsTab('privacy')">
              <span style="margin-right: 8px;">üõ°Ô∏è</span>
              Privacy & Trattamento Dati
            </button>
            <button class="settings-tab-btn" data-tab="templates" onclick="switchSettingsTab('templates')">
              <span style="margin-right: 8px;">üé®</span>
              Template
            </button>
            <button class="settings-tab-btn" data-tab="settings" onclick="switchSettingsTab('settings')">
              <span style="margin-right: 8px;">‚öôÔ∏è</span>
              Impostazioni
            </button>
            <button class="settings-tab-btn" data-tab="help" onclick="switchSettingsTab('help')">
              <span style="margin-right: 8px;">‚ùì</span>
              Aiuto & Assistenza
            </button>
          </div>

          <!-- Tab: Export & Condivisione -->
          <div class="settings-tab-content active" id="settings-export">
            <h4 style="color: #003d7a; margin-bottom: 15px;">üì§ Export e Condivisione</h4>
            
            <div style="background: #f3f4f6; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 20px;">
              <div style="font-size: 48px; margin-bottom: 16px;">üìÑ</div>
              <h5 style="margin-bottom: 8px;">Esporta il tuo CV</h5>
              <p style="color: #6b7280; margin-bottom: 16px;">Scarica il tuo CV in formato PDF per la stampa</p>
              <button class="header-btn" onclick="printCV()" style="background: #059669; color: white;">
                üìÑ Scarica PDF
              </button>
            </div>

            <div style="background: #f3f4f6; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
              <h5 style="margin-bottom: 12px;">üîÑ Backup e Ripristino</h5>
              <p style="color: #6b7280; margin-bottom: 16px;">Salva una copia dei tuoi dati per poterli importare in futuro</p>
              
              <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                <button type="button" class="header-btn" onclick="exportData()">
                  üì§ Esporta Backup Completo
                </button>
                <button type="button" class="header-btn" onclick="importData()">
                  üì• Importa Backup
                </button>
                <button type="button" class="header-btn" onclick="resetData()" style="background: #dc2626; color: white;">
                  üóëÔ∏è Reset Completo
                </button>
              </div>
              
              <input type="file" id="importInput" accept=".json" style="display: none;">
            </div>

            <div style="background: #fef3c7; border: 1px solid #f59e0b; padding: 16px; border-radius: 8px;">
              <h6 style="color: #92400e; margin-bottom: 8px;">‚ö†Ô∏è Importante:</h6>
              <p style="color: #92400e; font-size: 14px;">I tuoi dati sono salvati solo in questo browser. Esporta un backup per non perdere il lavoro!</p>
            </div>
          </div>

          <!-- Tab: Privacy & Trattamento Dati -->
          <div class="settings-tab-content" id="settings-privacy">
            <h4 style="color: #003d7a; margin-bottom: 15px;">üõ°Ô∏è Trattamento Dati Personali</h4>
            
            <!-- Gestione Clausola Privacy -->
            <div style="background: #f3f4f6; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
              <h5 style="margin-bottom: 12px;">üìã Clausola Privacy nel CV</h5>
              
              <!-- Toggle Inclusione -->
              <label class="form-label" style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                <input type="checkbox" id="includePrivacy" checked>
                <span><strong>Includi clausola trattamento dati nel CV stampato</strong></span>
              </label>
              
              <!-- Campo Testo Clausola -->
              <div id="privacyClause" style="margin-top: 15px;">
                <label class="form-label" for="privacyText" style="margin-bottom: 8px;"><strong>Testo clausola privacy:</strong></label>
                <textarea 
                  id="privacyText" 
                  style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; line-height: 1.5; min-height: 80px; resize: vertical;"
                  placeholder="Autorizzo il trattamento dei dati personali contenuti nel mio curriculum vitae in base all'art. 13 del D. Lgs. 196/2003 e all'art. 13 GDPR 679/16."
                ></textarea>
                <p style="color: #6b7280; font-size: 12px; margin-top: 6px;">
                  üí° <em>Questo testo apparir√† in piccolo alla fine del tuo CV stampato</em>
                </p>
              </div>
              
              <p style="color: #16a34a; font-size: 14px; margin-top: 12px; padding: 8px 12px; background: #f0fdf4; border-left: 4px solid #16a34a; border-radius: 4px;">
                ‚úÖ <strong>Consigliato:</strong> Include automaticamente il consenso per il trattamento dei dati personali (richiesto per legge in Italia)
              </p>
            </div>

            <div style="background: #ecfdf5; border: 1px solid #10b981; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
              <h6 style="color: #047857; margin-bottom: 8px;">‚úÖ La tua privacy √® garantita</h6>
              <ul style="color: #047857; font-size: 14px; margin-left: 16px;">
                <li>Tutti i dati sono salvati solo nel TUO browser</li>
                <li>Nessun dato viene mai trasmesso a server esterni</li>
                <li>Zero tracking, zero cookies di profilazione</li>
                <li>App completamente offline dopo il primo caricamento</li>
              </ul>
            </div>

            <div style="background: #f3f4f6; padding: 20px; border-radius: 8px;">
              <h6 style="margin-bottom: 12px;">üìã Cosa salviamo e dove:</h6>
              <ul style="color: #374151; font-size: 14px; margin-left: 16px;">
                <li><strong>Dati del CV</strong>: Solo nel localStorage del TUO browser</li>
                <li><strong>Impostazioni app</strong>: Solo nel localStorage del TUO browser</li>
                <li><strong>Consenso cookie</strong>: Solo nel localStorage del TUO browser</li>
                <li><strong>Zero dati su server esterni</strong>: Mai trasmesso nulla</li>
              </ul>
            </div>
          </div>

          <!-- Tab: Template -->
          <div class="settings-tab-content" id="settings-templates">
            <h4 style="color: #003d7a; margin-bottom: 15px;">üé® Template Disponibili</h4>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
              <!-- Template Europass -->
              <div class="template-card active" data-template="europass" onclick="selectTemplate('europass')" 
                   style="padding: 20px; border: 2px solid #2563eb; border-radius: 8px; cursor: pointer; background: #eff6ff;">
                <div style="display: flex; align-items: center; gap: 16px;">
                  <div style="font-size: 48px;">üá™üá∫</div>
                  <div>
                    <h6 style="color: #1e40af; margin-bottom: 4px;">Europass Standard</h6>
                    <p style="color: #3730a3; font-size: 14px; margin-bottom: 8px;">Template ufficiale Europass EU</p>
                    <span style="background: #dbeafe; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                      ‚úì Attivo
                    </span>
                  </div>
                </div>
              </div>

              <!-- Template Moderno -->
              <div class="template-card" data-template="modern" onclick="selectTemplate('modern')" 
                   style="padding: 20px; border: 2px solid #d1d5db; border-radius: 8px; cursor: pointer; background: #f9fafb;">
                <div style="display: flex; align-items: center; gap: 16px;">
                  <div style="font-size: 48px;">‚ú®</div>
                  <div>
                    <h6 style="color: #374151; margin-bottom: 4px;">Moderno</h6>
                    <p style="color: #6b7280; font-size: 14px; margin-bottom: 8px;">Design pulito e contemporaneo</p>
                    <span style="background: #f3f4f6; color: #6b7280; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                      Disponibile
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Impostazioni -->
          <div class="settings-tab-content" id="settings-settings">
            <h4 style="color: #003d7a; margin-bottom: 15px;">‚öôÔ∏è Impostazioni Visualizzazione</h4>
            
            <div style="background: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
              <div style="display: grid; gap: 16px;">
                <!-- Toggle Foto Profilo -->
                <label class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                  <div>
                    <strong>üì∑ Foto Profilo</strong>
                    <p style="color: #6b7280; font-size: 14px; margin-top: 4px;">Visualizza/nascondi la foto nel CV stampato</p>
                  </div>
                  <input type="checkbox" id="showPhoto" checked style="transform: scale(1.2);">
                </label>

                <!-- Toggle Pubblicazioni -->
                <label class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                  <div>
                    <strong>üìö Sezione Pubblicazioni</strong>
                    <p style="color: #6b7280; font-size: 14px; margin-top: 4px;">Visualizza/nascondi la sezione pubblicazioni nel CV stampato</p>
                  </div>
                  <input type="checkbox" id="showPublications" checked style="transform: scale(1.2);">
                </label>

                <!-- Formato Date -->
                <div style="display: flex; align-items: center; justify-content: space-between;">
                  <div>
                    <strong>üìÖ Formato Date</strong>
                    <p style="color: #6b7280; font-size: 14px; margin-top: 4px;">Scegli il formato per le date nel CV</p>
                  </div>
                  <select id="dateFormat" style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                    <option value="italian">Italiano (MM/AAAA)</option>
                    <option value="iso">ISO (AAAA-MM)</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Informazioni CV -->
            <div style="background: #f3f4f6; padding: 16px; border-radius: 8px;">
              <h5 style="margin-bottom: 8px;">üìä Informazioni CV</h5>
              <div style="font-size: 14px; color: #6b7280;">
                <p><strong>Versione App:</strong> v5.2.0</p>
                <p><strong>Template:</strong> <span id="currentTemplate">Europass Standard</span></p>
                <p><strong>Ultima Modifica:</strong> <span id="lastModified">-</span></p>
              </div>
            </div>
          </div>

          <!-- Tab: Aiuto & Assistenza -->
          <div class="settings-tab-content" id="settings-help">
            <h4 style="color: #003d7a; margin-bottom: 15px;">‚ùì Aiuto & Assistenza</h4>
            
            <div style="background: #f0fdf4; border: 1px solid #22c55e; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
              <h5 style="color: #15803d; margin-bottom: 12px;">üÜò Hai bisogno di aiuto?</h5>
              <p style="color: #15803d; margin-bottom: 16px;">Per supporto tecnico o domande sull'utilizzo dell'app:</p>
              
              <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <a href="https://github.com/EduTechLab-ita/cv-pwa-editor/issues" target="_blank" class="header-btn" 
                   style="background: #059669; color: white; text-decoration: none;">
                  üêõ Segnala Bug
                </a>
                <a href="https://github.com/EduTechLab-ita/cv-pwa-editor" target="_blank" class="header-btn" 
                   style="background: #0891b2; color: white; text-decoration: none;">
                  üìñ Documentazione
                </a>
                <a href="mailto:info@edutechlab.it" class="header-btn" 
                   style="background: #7c3aed; color: white; text-decoration: none;">
                  ‚úâÔ∏è Contatta Supporto
                </a>
              </div>
            </div>

            <div style="background: #fef3c7; border: 1px solid #f59e0b; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
              <h6 style="color: #92400e; margin-bottom: 8px;">üí° Suggerimenti utili:</h6>
              <ul style="color: #92400e; font-size: 14px; margin-left: 16px;">
                <li>Fai un backup regolare dei tuoi dati (tab "Export & Condivisione")</li>
                <li>Utilizza il formato PDF per la stampa professionale</li>
                <li>La foto profilo √® opzionale - puoi disattivarla nelle impostazioni</li>
                <li>L'app funziona completamente offline dopo il primo caricamento</li>
              </ul>
            </div>

            <div style="background: #f3f4f6; padding: 16px; border-radius: 8px;">
              <h6 style="margin-bottom: 8px;">‚ÑπÔ∏è Informazioni App</h6>
              <p style="color: #6b7280; font-size: 14px;">
                <strong>CV PWA Editor v5.2</strong><br>
                Sviluppato da <strong>EduTechLab Italia</strong> (Fabio Rizzotto)<br>
                App gratuita per la creazione di CV formato Europass<br>
                ¬© 2025 EduTechLab Italia - Licenza MIT
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Anteprima -->
      <div class="section" id="preview">
        <div class="content-header">
          <h2 class="section-title">
            <span>üëÅÔ∏è</span>
            Anteprima CV
          </h2>
        </div>
        
        <div class="content-body">
          <div class="cv-preview" id="cvPreview">
            <div class="empty-state">
              <h3>Anteprima del tuo CV</h3>
              <p>Compila i campi nelle altre sezioni per vedere l'anteprima qui.</p>
            </div>
          </div>
        </div>
      </div>
      
    </main>
    
  </div>
  
  <!-- Footer -->
  <footer class="app-footer">
    <div class="footer-links">
      <a href="#" class="footer-link">Info & Assistenza</a>
      <a href="#" class="footer-link">Privacy & Cookie</a>
      <a href="#" class="footer-link">GitHub</a>
    </div>
    <p><strong>CV PWA Editor v5.1</strong> - Sviluppato da <strong>EduTechLab Italia</strong> (Fabio Rizzotto)</p>
    <p>¬© 2025 EduTechLab Italia - App gratuita per la creazione di CV Europass</p>
  </footer>
  
  <!-- Save Indicator -->
  <div class="save-indicator" id="saveIndicator">
    ‚úÖ Salvato automaticamente
  </div>
  
  <!-- JavaScript -->
  <script>
    // === CV PWA EDITOR v5.1 - DESIGN UPGRADE ===
    
    // Stato globale applicazione
    const AppState = {
      currentSection: 'personal',
      cvData: {
        personal: {
          fullName: '',
          nationality: 'Italiana',
          birthDate: '',
          phone: '',
          email: '',
          address: '',
          website: '',
          photo: null // base64 string
        },
        profile: {
          text: ''
        },
        experience: [],
        education: [],
        formatore: [],
        skills: {
          ai: {
            title: 'Competenze Specialistiche',
            content: ''
          },
          digital: {
            title: 'Competenze Digitali',
            genericContent: '',
            useDigiCompEU: false,
            digiCompItems: [
              { name: 'Elaborazione delle informazioni', level: 'INTERMEDIO', numeric: 'Livello 4/6' },
              { name: 'Comunicazione digitale', level: 'INTERMEDIO', numeric: 'Livello 4/6' },
              { name: 'Creazione di contenuti digitali', level: 'INTERMEDIO', numeric: 'Livello 4/6' },
              { name: 'Sicurezza digitale', level: 'INTERMEDIO', numeric: 'Livello 4/6' },
              { name: 'Risoluzione di problemi digitali', level: 'AVANZATO', numeric: 'Livello 5/6' }
            ]
          },
          platforms: ''
        },
        languages: {
          motherTongue: 'Italiano',
          motherTongueLevel: 'C2',
          otherLanguages: []
        },
        publications: [],
        other: {
          skills: '',
          includePrivacy: true,
          privacyText: 'Autorizzo il trattamento dei dati personali contenuti nel mio curriculum vitae in base all\'art. 13 del D. Lgs. 196/2003 e all\'art. 13 GDPR 679/16.'
        },
        settings: {
          showPhoto: true,
          showPublications: true,
          italianDateFormat: true,
          templateStyle: 'europass',
          dateFormat: 'italian'
        }
      },
      
      // Carica dati da localStorage
      loadData() {
        try {
          const saved = localStorage.getItem('cvData_v5');
          if (saved) {
            const parsed = JSON.parse(saved);
            this.cvData = { ...this.cvData, ...parsed };
            console.log('‚úÖ Dati caricati da localStorage');
          }
        } catch (error) {
          console.log('‚ö†Ô∏è Errore caricamento dati:', error);
        }
      },
      
      // Salva dati in localStorage
      saveData() {
        try {
          localStorage.setItem('cvData_v5', JSON.stringify(this.cvData));
          this.showSaveIndicator();
          console.log('‚úÖ Dati salvati in localStorage');
        } catch (error) {
          console.error('‚ùå Errore salvataggio:', error);
        }
      },
      
      // Mostra indicatore salvataggio
      showSaveIndicator() {
        const indicator = document.getElementById('saveIndicator');
        indicator.classList.add('show');
        setTimeout(() => {
          indicator.classList.remove('show');
        }, 2000);
      },
      
      // Aggiorna campo dati
      updateField(section, field, value) {
        if (!this.cvData[section]) {
          this.cvData[section] = {};
        }
        this.cvData[section][field] = value;
        this.saveData();
      },
      
      // Aggiorna anteprima CV
      updatePreview() {
        const preview = document.getElementById('cvPreview');
        const data = this.cvData;
        
        // Applica la classe del template selezionato
        preview.className = 'cv-preview';
        if (data.settings.templateStyle === 'modern') {
          preview.classList.add('modern-template');
        }
        
        // Se non ci sono dati, mostra empty state
        if (!data.personal.fullName && !data.profile.text) {
          preview.innerHTML = `
            <div class="empty-state">
              <h3>Anteprima del tuo CV</h3>
              <p>üëÜ Compila i campi nelle altre sezioni per vedere il tuo CV qui!</p>
            </div>
          `;
          return;
        }
        
        let html = `
          <!-- Europass Header -->
          <div class="europass-header">
            <div style="font-size: 1.2em; color: #003d7a;">
              <span style="background: #003d7a; color: white; padding: 4px 8px; margin-right: 10px; border-radius: 3px; font-weight: bold; font-size: 0.8em;">üá™üá∫</span>
              europass
            </div>
          </div>
          
          <div class="cv-title">Curriculum Vitae</div>
          <div class="page-bar"></div>
          
          <div class="cv-header" style="position: relative;">
            ${data.personal.photo && data.settings.showPhoto ? 
              `<img src="${data.personal.photo}" class="cv-profile-photo" alt="Foto profilo">` : ''}
            
            <h1 class="cv-name">${data.personal.fullName || 'Il Tuo Nome'}</h1>
            
            <div class="cv-contact-grid" style="${data.personal.photo && data.settings.showPhoto ? 'margin-right: 140px;' : ''}">
              ${data.personal.nationality ? `<div class="cv-contact-item">üìç ${data.personal.nationality}</div>` : ''}
              ${data.personal.birthDate ? `<div class="cv-contact-item">üéÇ ${data.personal.birthDate}</div>` : ''}
              ${data.personal.phone ? `<div class="cv-contact-item">üìû ${this.linkifyText(data.personal.phone)}</div>` : ''}
              ${data.personal.email ? `<div class="cv-contact-item">‚úâÔ∏è ${this.linkifyText(data.personal.email)}</div>` : ''}
              ${data.personal.website ? `<div class="cv-contact-item">üåê ${this.linkifyText(data.personal.website)}</div>` : ''}
            </div>
            
            ${data.personal.address ? `<div class="cv-address">üìç ${data.personal.address}</div>` : ''}
          </div>
        `;
        
        // Profilo
        if (data.profile.text) {
          html += `
            <div class="cv-section">
              <h2 class="cv-section-title">Profilo Professionale</h2>
              <div class="cv-content">${this.linkifyText(data.profile.text)}</div>
            </div>
          `;
        }
        
        // Esperienza
        if (data.experience.length > 0) {
          html += `
            <div class="cv-section">
              <h2 class="cv-section-title">Esperienza Lavorativa</h2>
              <div class="cv-content">
                ${data.experience.map(exp => `
                  <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; font-weight: 600; color: #003d7a;">
                      <span>${exp.position}</span>
                      <span>${exp.startDate} - ${exp.endDate}</span>
                    </div>
                    <div style="font-weight: 500; margin: 5px 0;">${exp.company}</div>
                    ${exp.description ? `<div style="margin-top: 8px;">${this.linkifyText(exp.description)}</div>` : ''}
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
        
        // Formazione
        if (data.education.length > 0) {
          html += `
            <div class="cv-section">
              <h2 class="cv-section-title">Istruzione e Formazione</h2>
              <div class="cv-content">
                ${data.education.map(edu => `
                  <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; font-weight: 600; color: #003d7a;">
                      <span>${edu.degree}</span>
                      <span>${edu.startDate} - ${edu.endDate}</span>
                    </div>
                    <div style="font-weight: 500; margin: 5px 0;">${edu.institution}</div>
                    ${edu.description ? `<div style="margin-top: 8px;">${this.linkifyText(edu.description)}</div>` : ''}
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
        
        // Formatore
        if (data.formatore.length > 0) {
          html += `
            <div class="cv-section">
              <h2 class="cv-section-title">Esperienza come Formatore</h2>
              <div class="cv-content">
                ${data.formatore.map(form => `
                  <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; font-weight: 600; color: #003d7a;">
                      <span>${form.title}</span>
                      <span>${form.period}</span>
                    </div>
                    ${form.hours ? `<div style="font-weight: 500; color: #1d4ed8; margin: 5px 0;">${form.hours}</div>` : ''}
                    ${form.institutions ? `<div style="font-weight: 500; margin: 5px 0;">${form.institutions}</div>` : ''}
                    ${form.topics ? `<div style="margin-top: 8px;"><strong>Tematiche:</strong> ${this.linkifyText(form.topics)}</div>` : ''}
                    ${form.details && form.details.length > 0 ? `
                      <div style="margin-top: 8px;">
                        <strong>Dettaglio attivit√†:</strong>
                        <ul style="margin: 5px 0 0 20px;">
                          ${form.details.map(detail => `<li>${this.linkifyText(detail)}</li>`).join('')}
                        </ul>
                      </div>
                    ` : ''}
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
        
        // Competenze
        if ((data.skills.ai && data.skills.ai.content) || (data.skills.digital && (data.skills.digital.genericContent || data.skills.digital.useDigiCompEU)) || data.skills.platforms) {
          html += `
            <div class="cv-section">
              <h2 class="cv-section-title">Competenze</h2>
              <div class="cv-content">
                ${data.skills.ai && data.skills.ai.content ? `
                  <div style="margin-bottom: 20px; padding: 15px; background: #eff6ff; border-left: 4px solid #3b82f6; border-radius: 6px;">
                    <strong style="color: #003d7a;">${data.skills.ai.title}:</strong><br>
                    ${this.linkifyText(data.skills.ai.content)}
                  </div>
                ` : ''}
                
                ${data.skills.digital && (data.skills.digital.genericContent || data.skills.digital.useDigiCompEU) ? `
                  <div style="margin-bottom: 20px;">
                    <strong style="color: #003d7a;">Competenze Digitali:</strong><br>
                    ${data.skills.digital.genericContent ? `<div style="margin: 10px 0;">${this.linkifyText(data.skills.digital.genericContent)}</div>` : ''}
                    
                    ${data.skills.digital.useDigiCompEU && data.skills.digital.digiCompItems ? `
                      <div style="margin-top: 15px; padding: 12px; background: #f9fafb; border-radius: 6px;">
                        <strong style="color: #1d4ed8; font-size: 0.9em;">Competenze DigiCompEU (Framework Europeo):</strong>
                        <div style="margin-top: 8px; display: grid; gap: 6px;">
                          ${data.skills.digital.digiCompItems.map(skill => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid #e5e7eb;">
                              <span style="font-weight: 500;">${skill.name}</span>
                              <span style="background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">${skill.level} (${skill.numeric})</span>
                            </div>
                          `).join('')}
                        </div>
                      </div>
                    ` : ''}
                  </div>
                ` : ''}
                
                ${data.skills.platforms ? `<div style="margin-bottom: 15px;"><strong>Piattaforme e Software:</strong><br>${this.linkifyText(data.skills.platforms)}</div>` : ''}
              </div>
            </div>
          `;
        }
        
        // Lingue
        if (data.languages.motherTongue || data.languages.otherLanguages.length > 0) {
          html += `
            <div class="cv-section">
              <h2 class="cv-section-title">Lingue</h2>
              <div class="cv-content">
                <div style="margin-bottom: 10px;"><strong>Madrelingua:</strong> ${data.languages.motherTongue} (${data.languages.motherTongueLevel})</div>
                ${data.languages.otherLanguages.length > 0 ? `
                  <div><strong>Altre lingue:</strong></div>
                  ${data.languages.otherLanguages.map(lang => 
                    `<div style="margin-left: 20px;">‚Ä¢ ${lang.name}: ${lang.level}</div>`
                  ).join('')}
                ` : ''}
              </div>
            </div>
          `;
        }
        
        // Pubblicazioni
        if (data.publications.length > 0 && data.settings.showPublications) {
          html += `
            <div class="cv-section">
              <h2 class="cv-section-title">Pubblicazioni</h2>
              <div class="cv-content">
                ${data.publications.map(pub => `
                  <div style="margin-bottom: 15px;">
                    <div style="font-weight: 600; color: #003d7a;">${pub.title}</div>
                    <div style="font-style: italic; margin: 5px 0;">${pub.authors} (${pub.year})</div>
                    ${pub.journal ? `<div style="margin: 5px 0;"><strong>In:</strong> ${pub.journal}</div>` : ''}
                    ${pub.doi ? `<div style="margin: 5px 0;"><strong>DOI:</strong> ${this.linkifyText(pub.doi)}</div>` : ''}
                    ${pub.link ? `<div style="margin: 5px 0;"><strong>Link:</strong> ${this.linkifyText(pub.link)}</div>` : ''}
                    ${pub.description ? `<div style="margin-top: 8px;">${this.linkifyText(pub.description)}</div>` : ''}
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
        
        // Altre informazioni
        if (data.other.skills) {
          html += `
            <div class="cv-section">
              <h2 class="cv-section-title">Altre Capacit√† e Competenze</h2>
              <div class="cv-content">${this.linkifyText(data.other.skills)}</div>
            </div>
          `;
        }
        
        // Privacy
        if (data.other.includePrivacy && data.other.privacyText) {
          html += `
            <div class="cv-section" style="margin-top: 30px; font-size: 0.8rem; color: #6b7280;">
              <div class="cv-content">${data.other.privacyText}</div>
            </div>
          `;
        }
        
        // Footer con conteggio pagine
        html += `
          <div class="page-counter" style="position: fixed; bottom: 20px; right: 20px; font-size: 0.75rem; color: #6b7280; background: white; padding: 4px 8px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            Pagina 1 di 1
          </div>
        `;
        
        preview.innerHTML = html;
        
        // Calcola pagine dopo il rendering
        setTimeout(() => {
          calculatePages();
        }, 100);
      },
      
      // Link attivi
      linkifyText(text) {
        if (!text) return text;
        
        const urlRegex = /(https?:\/\/[^\s]+)/g;
        const emailRegex = /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g;
        
        return text
          .replace(urlRegex, '<a href="$1" target="_blank" style="color: #0066cc; text-decoration: underline;">$1</a>')
          .replace(emailRegex, '<a href="mailto:$1" style="color: #0066cc; text-decoration: underline;">$1</a>');
      }
    };
    
    // === FUNZIONI GLOBALI ===
    
    // Utility function for creating clickable links
    function linkifyText(text) {
      if (!text) return text;
      
      // Regex per URL e email
      const urlRegex = /(https?:\/\/[^\s]+)/g;
      const emailRegex = /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g;
      
      // Sostituisce URL
      let result = text.replace(urlRegex, (url) => {
        return `<a href="${url}" target="_blank" rel="noopener noreferrer" style="color: #0066cc; text-decoration: underline;">${url}</a>`;
      });
      
      // Sostituisce email
      result = result.replace(emailRegex, (email) => {
        return `<a href="mailto:${email}" style="color: #0066cc; text-decoration: underline;">${email}</a>`;
      });
      
      return result;
    }
    
    // Function to calculate pages for CV
    function calculatePages() {
      const element = document.querySelector('.cv-preview');
      if (!element) return 1;
      
      const height = element.scrollHeight;
      const pageHeight = 1056; // A4 height at 72 DPI (297mm)
      const calculatedPages = Math.ceil(height / pageHeight);
      
      // Update page count in footer
      const pageCounter = document.querySelector('.page-counter');
      if (pageCounter) {
        pageCounter.textContent = `Pagina 1 di ${calculatedPages}`;
      }
      
      return calculatedPages;
    }
    
    // Render DigiCompEU items
    function renderDigiCompItems() {
      const container = document.getElementById('digiCompItems');
      if (!container || !AppState.cvData.skills.digital.digiCompItems) return;
      
      container.innerHTML = AppState.cvData.skills.digital.digiCompItems.map((skill, index) => `
        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: white; border: 1px solid #d1d5db; border-radius: 6px;">
          <div style="flex: 1; margin-right: 16px;">
            <input type="text" value="${skill.name}" 
                   onchange="updateDigiCompItem(${index}, 'name', this.value)"
                   style="width: 100%; padding: 4px 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.875rem;">
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <select onchange="updateDigiCompItem(${index}, 'level', this.value)" 
                    style="padding: 4px 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.875rem;">
              <option value="BASE" ${skill.level === 'BASE' ? 'selected' : ''}>BASE</option>
              <option value="INTERMEDIO" ${skill.level === 'INTERMEDIO' ? 'selected' : ''}>INTERMEDIO</option>
              <option value="AVANZATO" ${skill.level === 'AVANZATO' ? 'selected' : ''}>AVANZATO</option>
            </select>
            <input type="text" value="${skill.numeric}" placeholder="Livello X/6"
                   onchange="updateDigiCompItem(${index}, 'numeric', this.value)"
                   style="width: 80px; padding: 4px 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.875rem;">
          </div>
        </div>
      `).join('');
    }
    
    // Update DigiCompEU item
    function updateDigiCompItem(index, field, value) {
      if (AppState.cvData.skills.digital.digiCompItems[index]) {
        AppState.cvData.skills.digital.digiCompItems[index][field] = value;
        AppState.saveData();
      }
    }
    
    // === UPLOAD FOTO ===
    
    // Gestisce upload foto
    function handlePhotoUpload(file) {
      if (file && file.type.startsWith('image/')) {
        if (file.size > 2 * 1024 * 1024) { // 2MB limit
          alert('File troppo grande. Massimo 2MB.');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = (e) => {
          const photoData = e.target.result;
          AppState.cvData.personal.photo = photoData;
          AppState.saveData();
          showPhotoPreview(photoData);
        };
        reader.readAsDataURL(file);
      }
    }
    
    // Mostra anteprima foto
    function showPhotoPreview(photoData) {
      const uploadArea = document.getElementById('photoUpload');
      const previewContainer = document.getElementById('photoPreview');
      const photoImg = document.getElementById('photoImg');
      
      uploadArea.style.display = 'none';
      previewContainer.style.display = 'block';
      photoImg.src = photoData;
    }
    
    // Rimuove foto
    function removePhoto() {
      AppState.cvData.personal.photo = null;
      AppState.saveData();
      
      const uploadArea = document.getElementById('photoUpload');
      const previewContainer = document.getElementById('photoPreview');
      
      uploadArea.style.display = 'block';
      previewContainer.style.display = 'none';
    }
    
    // === LISTE DINAMICHE ===
    
    // Esperienza lavorativa
    function addExperience() {
      const newExp = {
        id: Date.now(),
        startDate: '',
        endDate: '',
        current: false,
        position: '',
        company: '',
        description: ''
      };
      AppState.cvData.experience.push(newExp);
      AppState.saveData();
      renderExperienceList();
    }
    
    function removeExperience(id) {
      AppState.cvData.experience = AppState.cvData.experience.filter(exp => exp.id !== id);
      AppState.saveData();
      renderExperienceList();
    }
    
    function renderExperienceList() {
      const container = document.getElementById('experienceList');
      if (AppState.cvData.experience.length === 0) {
        container.innerHTML = '<div style="padding: 20px; text-align: center; color: #6b7280;">Nessuna esperienza aggiunta</div>';
        return;
      }
      
      container.innerHTML = AppState.cvData.experience.map(exp => `
        <div class="list-item">
          <div class="list-item-header">
            <div class="list-item-title">${exp.position || 'Posizione non specificata'}</div>
            <div class="list-item-controls">
              <button class="list-btn danger" onclick="removeExperience(${exp.id})">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Data inizio</label>
              <input type="text" class="form-input" placeholder="MM/AAAA" value="${exp.startDate}" 
                     onchange="updateExperience(${exp.id}, 'startDate', this.value)">
            </div>
            <div class="form-group">
              <label class="form-label">Data fine</label>
              <input type="text" class="form-input" placeholder="MM/AAAA o 'In corso'" value="${exp.endDate}"
                     onchange="updateExperience(${exp.id}, 'endDate', this.value)">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Posizione/Ruolo</label>
              <input type="text" class="form-input" placeholder="Es. Sviluppatore Software" value="${exp.position}"
                     onchange="updateExperience(${exp.id}, 'position', this.value)">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Azienda/Organizzazione</label>
              <input type="text" class="form-input" placeholder="Nome azienda" value="${exp.company}"
                     onchange="updateExperience(${exp.id}, 'company', this.value)">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Descrizione</label>
              <textarea class="form-textarea" placeholder="Descrivi le tue responsabilit√† e risultati" 
                        onchange="updateExperience(${exp.id}, 'description', this.value)">${exp.description}</textarea>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function updateExperience(id, field, value) {
      const exp = AppState.cvData.experience.find(e => e.id === id);
      if (exp) {
        exp[field] = value;
        AppState.saveData();
      }
    }
    
    // Formazione
    function addEducation() {
      const newEdu = {
        id: Date.now(),
        startDate: '',
        endDate: '',
        degree: '',
        institution: '',
        description: ''
      };
      AppState.cvData.education.push(newEdu);
      AppState.saveData();
      renderEducationList();
    }
    
    function removeEducation(id) {
      AppState.cvData.education = AppState.cvData.education.filter(edu => edu.id !== id);
      AppState.saveData();
      renderEducationList();
    }
    
    function renderEducationList() {
      const container = document.getElementById('educationList');
      if (AppState.cvData.education.length === 0) {
        container.innerHTML = '<div style="padding: 20px; text-align: center; color: #6b7280;">Nessuna formazione aggiunta</div>';
        return;
      }
      
      container.innerHTML = AppState.cvData.education.map(edu => `
        <div class="list-item">
          <div class="list-item-header">
            <div class="list-item-title">${edu.degree || 'Titolo non specificato'}</div>
            <div class="list-item-controls">
              <button class="list-btn danger" onclick="removeEducation(${edu.id})">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Data inizio</label>
              <input type="text" class="form-input" placeholder="MM/AAAA" value="${edu.startDate}"
                     onchange="updateEducation(${edu.id}, 'startDate', this.value)">
            </div>
            <div class="form-group">
              <label class="form-label">Data fine</label>
              <input type="text" class="form-input" placeholder="MM/AAAA" value="${edu.endDate}"
                     onchange="updateEducation(${edu.id}, 'endDate', this.value)">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Titolo/Qualifica</label>
              <input type="text" class="form-input" placeholder="Es. Laurea in Informatica" value="${edu.degree}"
                     onchange="updateEducation(${edu.id}, 'degree', this.value)">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Istituto/Universit√†</label>
              <input type="text" class="form-input" placeholder="Nome istituzione" value="${edu.institution}"
                     onchange="updateEducation(${edu.id}, 'institution', this.value)">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Descrizione</label>
              <textarea class="form-textarea" placeholder="Materie principali, voto, progetti, etc."
                        onchange="updateEducation(${edu.id}, 'description', this.value)">${edu.description}</textarea>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function updateEducation(id, field, value) {
      const edu = AppState.cvData.education.find(e => e.id === id);
      if (edu) {
        edu[field] = value;
        AppState.saveData();
      }
    }
    
    // Formatore
    function addFormatore() {
      const newForm = {
        id: Date.now(),
        period: '',
        hours: '',
        title: '',
        institutions: '',
        topics: '',
        details: []
      };
      AppState.cvData.formatore.push(newForm);
      AppState.saveData();
      renderFormatoreList();
    }
    
    function removeFormatore(id) {
      AppState.cvData.formatore = AppState.cvData.formatore.filter(form => form.id !== id);
      AppState.saveData();
      renderFormatoreList();
    }
    
    function renderFormatoreList() {
      const container = document.getElementById('formatoreList');
      if (AppState.cvData.formatore.length === 0) {
        container.innerHTML = '<div style="padding: 20px; text-align: center; color: #6b7280;">Nessuna attivit√† formativa aggiunta</div>';
        return;
      }
      
      container.innerHTML = AppState.cvData.formatore.map(form => `
        <div class="list-item">
          <div class="list-item-header">
            <div class="list-item-title">${form.title || 'Attivit√† Formativa'}</div>
            <div class="list-item-controls">
              <button class="list-btn danger" onclick="removeFormatore(${form.id})">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Periodo</label>
              <input type="text" class="form-input" placeholder="es. Ottobre 2023 - Giugno 2025" value="${form.period}"
                     onchange="updateFormatore(${form.id}, 'period', this.value)">
            </div>
            <div class="form-group">
              <label class="form-label">Ore Totali</label>
              <input type="text" class="form-input" placeholder="es. 342 ore totali" value="${form.hours}"
                     onchange="updateFormatore(${form.id}, 'hours', this.value)">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Titolo Formazione</label>
              <input type="text" class="form-input" placeholder="Titolo del corso o progetto formativo" value="${form.title}"
                     onchange="updateFormatore(${form.id}, 'title', this.value)">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Enti e Istituzioni</label>
              <input type="text" class="form-input" placeholder="Scuole e istituzioni coinvolte" value="${form.institutions}"
                     onchange="updateFormatore(${form.id}, 'institutions', this.value)">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Tematiche Principali</label>
              <textarea class="form-textarea" placeholder="Tematiche principali del corso..."
                        onchange="updateFormatore(${form.id}, 'topics', this.value)">${form.topics}</textarea>
            </div>
            <div class="form-group full-width">
              <label class="form-label">Dettaglio Attivit√† (una per riga)</label>
              <textarea class="form-textarea" placeholder="Esempio: I.C. di Roma: 20 ore - Coding e Robotica&#10;Formazione Milano: 15 ore - Intelligenza Artificiale"
                        onchange="updateFormatore(${form.id}, 'details', this.value.split('\\n').filter(line => line.trim()))">${Array.isArray(form.details) ? form.details.join('\\n') : ''}</textarea>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function updateFormatore(id, field, value) {
      const form = AppState.cvData.formatore.find(f => f.id === id);
      if (form) {
        form[field] = value;
        AppState.saveData();
      }
    }
    
    // Lingue
    function addLanguage() {
      const newLang = {
        id: Date.now(),
        name: '',
        level: 'A1'
      };
      AppState.cvData.languages.otherLanguages.push(newLang);
      AppState.saveData();
      renderLanguagesList();
    }
    
    function removeLanguage(id) {
      AppState.cvData.languages.otherLanguages = AppState.cvData.languages.otherLanguages.filter(lang => lang.id !== id);
      AppState.saveData();
      renderLanguagesList();
    }
    
    function renderLanguagesList() {
      const container = document.getElementById('languagesList');
      if (AppState.cvData.languages.otherLanguages.length === 0) {
        container.innerHTML = '<div style="padding: 20px; text-align: center; color: #6b7280;">Nessuna lingua aggiunta</div>';
        return;
      }
      
      container.innerHTML = AppState.cvData.languages.otherLanguages.map(lang => `
        <div class="list-item">
          <div class="list-item-header">
            <div class="list-item-title">${lang.name || 'Lingua non specificata'}</div>
            <div class="list-item-controls">
              <button class="list-btn danger" onclick="removeLanguage(${lang.id})">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Lingua</label>
              <input type="text" class="form-input" placeholder="Es. Inglese" value="${lang.name}"
                     onchange="updateLanguage(${lang.id}, 'name', this.value)">
            </div>
            <div class="form-group">
              <label class="form-label">Livello</label>
              <select class="form-input" onchange="updateLanguage(${lang.id}, 'level', this.value)">
                <option value="A1" ${lang.level === 'A1' ? 'selected' : ''}>A1 - Principiante</option>
                <option value="A2" ${lang.level === 'A2' ? 'selected' : ''}>A2 - Elementare</option>
                <option value="B1" ${lang.level === 'B1' ? 'selected' : ''}>B1 - Intermedio</option>
                <option value="B2" ${lang.level === 'B2' ? 'selected' : ''}>B2 - Intermedio superiore</option>
                <option value="C1" ${lang.level === 'C1' ? 'selected' : ''}>C1 - Avanzato</option>
                <option value="C2" ${lang.level === 'C2' ? 'selected' : ''}>C2 - Madrelingua</option>
              </select>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function updateLanguage(id, field, value) {
      const lang = AppState.cvData.languages.otherLanguages.find(l => l.id === id);
      if (lang) {
        lang[field] = value;
        AppState.saveData();
      }
    }
    
    // Pubblicazioni
    function addPublication() {
      const newPub = {
        id: Date.now(),
        title: '',
        year: '',
        authors: '',
        journal: '',
        doi: '',
        link: '',
        description: ''
      };
      AppState.cvData.publications.push(newPub);
      AppState.saveData();
      renderPublicationsList();
    }
    
    function removePublication(id) {
      AppState.cvData.publications = AppState.cvData.publications.filter(pub => pub.id !== id);
      AppState.saveData();
      renderPublicationsList();
    }
    
    function renderPublicationsList() {
      const container = document.getElementById('publicationsList');
      if (AppState.cvData.publications.length === 0) {
        container.innerHTML = '<div style="padding: 20px; text-align: center; color: #6b7280;">Nessuna pubblicazione aggiunta</div>';
        return;
      }
      
      container.innerHTML = AppState.cvData.publications.map(pub => `
        <div class="list-item">
          <div class="list-item-header">
            <div class="list-item-title">${pub.title || 'Titolo non specificato'}</div>
            <div class="list-item-controls">
              <button class="list-btn danger" onclick="removePublication(${pub.id})">üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="form-grid">
            <div class="form-group full-width">
              <label class="form-label">Titolo</label>
              <input type="text" class="form-input" placeholder="Titolo della pubblicazione" value="${pub.title}"
                     onchange="updatePublication(${pub.id}, 'title', this.value)">
            </div>
            <div class="form-group">
              <label class="form-label">Anno</label>
              <input type="text" class="form-input" placeholder="2025" value="${pub.year}"
                     onchange="updatePublication(${pub.id}, 'year', this.value)">
            </div>
            <div class="form-group">
              <label class="form-label">Autori</label>
              <input type="text" class="form-input" placeholder="Nome Cognome, Altri autori" value="${pub.authors}"
                     onchange="updatePublication(${pub.id}, 'authors', this.value)">
            </div>
            <div class="form-group">
              <label class="form-label">Rivista/Conferenza</label>
              <input type="text" class="form-input" placeholder="Nome rivista" value="${pub.journal}"
                     onchange="updatePublication(${pub.id}, 'journal', this.value)">
            </div>
            <div class="form-group">
              <label class="form-label">DOI</label>
              <input type="text" class="form-input" placeholder="10.1000/xyz123" value="${pub.doi}"
                     onchange="updatePublication(${pub.id}, 'doi', this.value)">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Link</label>
              <input type="text" class="form-input" placeholder="https://..." value="${pub.link}"
                     onchange="updatePublication(${pub.id}, 'link', this.value)">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Descrizione</label>
              <textarea class="form-textarea" placeholder="Breve descrizione del lavoro"
                        onchange="updatePublication(${pub.id}, 'description', this.value)">${pub.description}</textarea>
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function updatePublication(id, field, value) {
      const pub = AppState.cvData.publications.find(p => p.id === id);
      if (pub) {
        pub[field] = value;
        AppState.saveData();
      }
    }
    
    // === EXPORT/IMPORT DATA ===
    
    function exportData() {
      const dataStr = JSON.stringify(AppState.cvData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `cv-data-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
    }
    
    function importData() {
      document.getElementById('importInput').click();
    }
    
    function resetData() {
      if (confirm('Sei sicuro di voler cancellare tutti i dati? Questa azione non pu√≤ essere annullata.')) {
        localStorage.removeItem('cvData_v5');
        location.reload();
      }
    }
    
    // Cambia sezione
    function switchSection(sectionId) {
      // Aggiorna stato
      AppState.currentSection = sectionId;
      
      // Aggiorna navigazione
      document.querySelectorAll('.nav-section').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
      
      // Aggiorna contenuto
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById(sectionId).classList.add('active');
      
      // Aggiorna anteprima SOLO quando si accede alla sezione preview
      if (sectionId === 'preview') {
        AppState.updatePreview();
      }
    }
    
    // === Settings Tabs Functions ===
    function switchSettingsTab(tabId) {
      // Rimuovi classe active da tutti i tab buttons
      document.querySelectorAll('.settings-tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Aggiungi classe active al button cliccato
      document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
      
      // Nascendi tutti i contenuti tab
      document.querySelectorAll('.settings-tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Mostra il contenuto del tab selezionato
      document.getElementById(`settings-${tabId}`).classList.add('active');
    }
    
    function selectTemplate(templateId) {
      // Rimuovi active da tutte le template cards
      document.querySelectorAll('.template-card').forEach(card => {
        card.classList.remove('active');
        card.style.border = '2px solid #d1d5db';
        card.style.background = '#f9fafb';
      });
      
      // Aggiungi active alla card selezionata
      const selectedCard = document.querySelector(`[data-template="${templateId}"]`);
      selectedCard.classList.add('active');
      selectedCard.style.border = '2px solid #2563eb';
      selectedCard.style.background = '#eff6ff';
      
      // Aggiorna le spans di stato
      document.querySelectorAll('.template-card span').forEach(span => {
        if (span.textContent.includes('‚úì Attivo')) {
          span.textContent = 'Disponibile';
          span.style.background = '#f3f4f6';
          span.style.color = '#6b7280';
        }
      });
      
      // Aggiorna la span della card attiva
      const activeSpan = selectedCard.querySelector('span');
      activeSpan.textContent = '‚úì Attivo';
      activeSpan.style.background = '#dbeafe';
      activeSpan.style.color = '#1e40af';
      
      // Aggiorna le informazioni
      const templateNames = {
        'europass': 'Europass Standard',
        'modern': 'Moderno'
      };
      
      document.getElementById('currentTemplate').textContent = templateNames[templateId];
      document.getElementById('templateStyle').value = templateId;
      
      // Salva la preferenza
      if (typeof AppState !== 'undefined') {
        AppState.cvData.settings.templateStyle = templateId;
        AppState.saveData();
        
        // Aggiorna l'anteprima se siamo nella sezione preview
        if (AppState.currentSection === 'preview') {
          AppState.updatePreview();
        }
      }
      
      console.log(`Template selezionato: ${templateId}`);
    }
    
    // === Settings Management Functions ===
    function initializeSettings() {
      // Carica le impostazioni dai dati salvati e aggiorna i controlli UI
      const settings = AppState.cvData.settings;
      
      // Aggiorna checkboxes
      const showPhotoCheckbox = document.getElementById('showPhoto');
      if (showPhotoCheckbox) showPhotoCheckbox.checked = settings.showPhoto;
      
      const showPublicationsCheckbox = document.getElementById('showPublications');
      if (showPublicationsCheckbox) showPublicationsCheckbox.checked = settings.showPublications;
      
      
      // Aggiorna select
      const dateFormatSelect = document.getElementById('dateFormat');
      if (dateFormatSelect) dateFormatSelect.value = settings.dateFormat;
      
      // Aggiorna informazioni
      const templateNames = {
        'europass': 'Europass Standard',
        'modern': 'Moderno'
      };
      
      const currentTemplateSpan = document.getElementById('currentTemplate');
      if (currentTemplateSpan) currentTemplateSpan.textContent = templateNames[settings.templateStyle] || 'Europass Standard';
      
      const lastModifiedSpan = document.getElementById('lastModified');
      if (lastModifiedSpan) {
        const lastModified = localStorage.getItem('cvData_v5_lastModified') || new Date().toISOString();
        lastModifiedSpan.textContent = new Date(lastModified).toLocaleString('it-IT');
      }
      
      console.log('‚úÖ Impostazioni inizializzate');
    }
    
    function updateSetting(settingKey, value) {
      // Aggiorna l'impostazione in AppState
      AppState.cvData.settings[settingKey] = value;
      AppState.saveData();
      
      // Salva timestamp ultima modifica
      localStorage.setItem('cvData_v5_lastModified', new Date().toISOString());
      
      console.log(`‚öôÔ∏è Impostazione aggiornata: ${settingKey} = ${value}`);
    }
    
    // Event handlers per i controlli delle impostazioni
    function attachSettingsHandlers() {
      // Checkbox handlers
      const showPhotoCheckbox = document.getElementById('showPhoto');
      if (showPhotoCheckbox) {
        showPhotoCheckbox.addEventListener('change', (e) => {
          updateSetting('showPhoto', e.target.checked);
        });
      }
      
      const showPublicationsCheckbox = document.getElementById('showPublications');
      if (showPublicationsCheckbox) {
        showPublicationsCheckbox.addEventListener('change', (e) => {
          updateSetting('showPublications', e.target.checked);
        });
      }
      
      
      // Select handlers
      const dateFormatSelect = document.getElementById('dateFormat');
      if (dateFormatSelect) {
        dateFormatSelect.addEventListener('change', (e) => {
          updateSetting('dateFormat', e.target.value);
        });
      }
      
      console.log('‚úÖ Event handlers impostazioni collegati');
    }
    
    // Banner versione
    function closeVersionBanner() {
      document.getElementById('versionBanner').style.display = 'none';
      localStorage.setItem('lastSeenVersion_v5', '5.2');
    }
    
    // Stampa CV
    function printCV() {
      if (AppState.currentSection !== 'preview') {
        switchSection('preview');
        setTimeout(() => window.print(), 500);
      } else {
        window.print();
      }
    }
    
    // === INIZIALIZZAZIONE ===
    
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ CV PWA Editor v5.2 con funzionalit√† v4.7 inizializzato');
      
      // Carica dati
      AppState.loadData();
      
      // Popola campi
      Object.keys(AppState.cvData.personal).forEach(field => {
        const input = document.getElementById(field);
        if (input && AppState.cvData.personal[field]) {
          input.value = AppState.cvData.personal[field];
        }
      });
      
      if (AppState.cvData.profile.text) {
        document.getElementById('profileText').value = AppState.cvData.profile.text;
      }
      
      // Popola competenze
      if (AppState.cvData.skills.ai.content) {
        document.getElementById('aiSkills').value = AppState.cvData.skills.ai.content;
      }
      if (AppState.cvData.skills.digital.genericContent) {
        document.getElementById('digitalSkillsGeneric').value = AppState.cvData.skills.digital.genericContent;
      }
      if (AppState.cvData.skills.platforms) {
        document.getElementById('platforms').value = AppState.cvData.skills.platforms;
      }
      
      // Toggle DigiCompEU
      const useDigiCompEUCheckbox = document.getElementById('useDigiCompEU');
      if (useDigiCompEUCheckbox && AppState.cvData.skills.digital.useDigiCompEU) {
        useDigiCompEUCheckbox.checked = true;
        document.getElementById('digiCompSection').style.display = 'block';
        renderDigiCompItems();
      }
      
      // Render liste dinamiche
      renderExperienceList();
      renderEducationList();
      renderFormatoreList();
      renderLanguagesList();
      renderPublicationsList();
      
      // Inizializza impostazioni avanzate
      initializeSettings();
      attachSettingsHandlers();
      
      // Aggiorna anteprima
      AppState.updatePreview();
      
      // Event listeners nativi per input
      ['fullName', 'nationality', 'birthDate', 'phone', 'email', 'address', 'website'].forEach(fieldId => {
        const input = document.getElementById(fieldId);
        if (input) {
          input.addEventListener('input', function(e) {
            AppState.updateField('personal', fieldId, e.target.value);
          });
        }
      });
      
      // Event listener profilo
      const profileTextarea = document.getElementById('profileText');
      if (profileTextarea) {
        profileTextarea.addEventListener('input', function(e) {
          AppState.updateField('profile', 'text', e.target.value);
        });
      }
      
      // Event listeners per competenze
      const aiSkillsTextarea = document.getElementById('aiSkills');
      if (aiSkillsTextarea) {
        aiSkillsTextarea.addEventListener('input', function(e) {
          AppState.cvData.skills.ai.content = e.target.value;
          AppState.saveData();
        });
      }
      
      const digitalSkillsGenericTextarea = document.getElementById('digitalSkillsGeneric');
      if (digitalSkillsGenericTextarea) {
        digitalSkillsGenericTextarea.addEventListener('input', function(e) {
          AppState.cvData.skills.digital.genericContent = e.target.value;
          AppState.saveData();
        });
      }
      
      const platformsTextarea = document.getElementById('platforms');
      if (platformsTextarea) {
        platformsTextarea.addEventListener('input', function(e) {
          AppState.cvData.skills.platforms = e.target.value;
          AppState.saveData();
        });
      }
      
      // Toggle DigiCompEU Event Listener
      if (useDigiCompEUCheckbox) {
        useDigiCompEUCheckbox.addEventListener('change', function(e) {
          AppState.cvData.skills.digital.useDigiCompEU = e.target.checked;
          const digiCompSection = document.getElementById('digiCompSection');
          digiCompSection.style.display = e.target.checked ? 'block' : 'none';
          if (e.target.checked) {
            renderDigiCompItems();
          }
          AppState.saveData();
        });
      }
      
      // Event listeners per lingue madrelingua
      const motherTongueInput = document.getElementById('motherTongue');
      if (motherTongueInput) {
        motherTongueInput.addEventListener('input', function(e) {
          AppState.cvData.languages.motherTongue = e.target.value;
          AppState.saveData();
        });
      }
      
      const motherTongueLevelSelect = document.getElementById('motherTongueLevel');
      if (motherTongueLevelSelect) {
        motherTongueLevelSelect.addEventListener('change', function(e) {
          AppState.cvData.languages.motherTongueLevel = e.target.value;
          AppState.saveData();
        });
      }
      
      // Event listener altre informazioni
      const otherSkillsTextarea = document.getElementById('otherSkills');
      if (otherSkillsTextarea) {
        otherSkillsTextarea.addEventListener('input', function(e) {
          AppState.cvData.other.skills = e.target.value;
          AppState.saveData();
        });
      }
      
      // Event listener privacy
      const includePrivacyCheckbox = document.getElementById('includePrivacy');
      if (includePrivacyCheckbox) {
        includePrivacyCheckbox.addEventListener('change', function(e) {
          AppState.cvData.other.includePrivacy = e.target.checked;
          AppState.saveData();
        });
      }
      
      const privacyTextTextarea = document.getElementById('privacyText');
      if (privacyTextTextarea) {
        privacyTextTextarea.addEventListener('input', function(e) {
          AppState.cvData.other.privacyText = e.target.value;
          AppState.saveData();
        });
      }
      
      // Event listeners per impostazioni
      ['showPhoto', 'showPublications', 'italianDateFormat'].forEach(settingId => {
        const checkbox = document.getElementById(settingId);
        if (checkbox) {
          checkbox.addEventListener('change', function(e) {
            AppState.cvData.settings[settingId] = e.target.checked;
            AppState.saveData();
          });
        }
      });
      
      // Upload foto eventi
      const photoInput = document.getElementById('photoInput');
      if (photoInput) {
        photoInput.addEventListener('change', function(e) {
          if (e.target.files[0]) {
            handlePhotoUpload(e.target.files[0]);
          }
        });
      }
      
      // Drag and drop foto
      const photoUpload = document.getElementById('photoUpload');
      if (photoUpload) {
        photoUpload.addEventListener('dragover', function(e) {
          e.preventDefault();
          photoUpload.classList.add('dragover');
        });
        
        photoUpload.addEventListener('dragleave', function(e) {
          e.preventDefault();
          photoUpload.classList.remove('dragover');
        });
        
        photoUpload.addEventListener('drop', function(e) {
          e.preventDefault();
          photoUpload.classList.remove('dragover');
          if (e.dataTransfer.files[0]) {
            handlePhotoUpload(e.dataTransfer.files[0]);
          }
        });
      }
      
      // Import data event
      const importInput = document.getElementById('importInput');
      if (importInput) {
        importInput.addEventListener('change', function(e) {
          if (e.target.files[0]) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
              try {
                const importedData = JSON.parse(event.target.result);
                AppState.cvData = { ...AppState.cvData, ...importedData };
                AppState.saveData();
                location.reload(); // Ricarica per mostrare tutti i dati
              } catch (error) {
                alert('Errore nel file JSON: ' + error.message);
              }
            };
            reader.readAsText(file);
          }
        });
      }
      
      // Carica dati salvati nei campi
      if (AppState.cvData.skills.ai.content) {
        document.getElementById('aiSkills').value = AppState.cvData.skills.ai.content;
      }
      if (AppState.cvData.skills.digital.genericContent) {
        document.getElementById('digitalSkillsGeneric').value = AppState.cvData.skills.digital.genericContent;  
      }
      if (AppState.cvData.skills.platforms) {
        document.getElementById('platforms').value = AppState.cvData.skills.platforms;
      }
      if (AppState.cvData.languages.motherTongue) {
        document.getElementById('motherTongue').value = AppState.cvData.languages.motherTongue;
      }
      if (AppState.cvData.languages.motherTongueLevel) {
        document.getElementById('motherTongueLevel').value = AppState.cvData.languages.motherTongueLevel;
      }
      if (AppState.cvData.other.skills) {
        document.getElementById('otherSkills').value = AppState.cvData.other.skills;
      }
      if (AppState.cvData.other.includePrivacy) {
        document.getElementById('includePrivacy').checked = true;
      }
      if (AppState.cvData.other.privacyText) {
        document.getElementById('privacyText').value = AppState.cvData.other.privacyText;
      }
      
      // Carica impostazioni
      document.getElementById('showPhoto').checked = AppState.cvData.settings.showPhoto;
      document.getElementById('showPublications').checked = AppState.cvData.settings.showPublications;
      document.getElementById('italianDateFormat').checked = AppState.cvData.settings.italianDateFormat;
      
      // Mostra foto se presente
      if (AppState.cvData.personal.photo) {
        showPhotoPreview(AppState.cvData.personal.photo);
      }
      
      // Controlla banner versione
      const lastSeenVersion = localStorage.getItem('lastSeenVersion_v5');
      if (!lastSeenVersion || lastSeenVersion !== '5.2') {
        document.getElementById('versionBanner').classList.add('show');
      }
      
      console.log('‚úÖ App inizializzata - Design upgrade completo!');
    });
    
    // === PWA SERVICE WORKER REGISTRATION ===
    
    // Registra Service Worker per funzionalit√† PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const registration = await navigator.serviceWorker.register('./sw.js');
          console.log('üîÑ Service Worker registrato:', registration.scope);
          
          // Ascolta aggiornamenti del SW
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // Nuovo SW disponibile - reload silenzioso
                console.log('üîÑ Nuovo Service Worker installato - aggiornamento in corso...');
                window.location.reload();
              }
            });
          });
          
        } catch (error) {
          console.error('‚ùå Service Worker registrazione fallita:', error);
        }
      });
    }
    
    // === PWA INSTALL PROMPT ===
    
    let deferredPrompt;
    let installButton;
    
    // Ascolta evento beforeinstallprompt
    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('üì≤ PWA installabile rilevata');
      e.preventDefault();
      deferredPrompt = e;
      
      // Mostra pulsante installa se non gi√† installata
      if (!window.matchMedia('(display-mode: standalone)').matches) {
        showInstallButton();
      }
    });
    
    // Mostra pulsante installazione
    function showInstallButton() {
      // Crea pulsante install se non esiste
      if (!installButton) {
        installButton = document.createElement('button');
        installButton.className = 'header-btn primary';
        installButton.innerHTML = 'üì≤ Installa App';
        installButton.onclick = installPWA;
        
        // Aggiungi al header actions
        const headerActions = document.querySelector('.header-actions');
        headerActions.insertBefore(installButton, headerActions.firstChild);
      }
      
      installButton.style.display = 'inline-block';
    }
    
    // Gestisce installazione PWA
    async function installPWA() {
      if (!deferredPrompt) return;
      
      try {
        const result = await deferredPrompt.prompt();
        console.log('üì≤ Risultato installazione PWA:', result.outcome);
        
        if (result.outcome === 'accepted') {
          // Nascondi pulsante install
          if (installButton) {
            installButton.style.display = 'none';
          }
        }
        
        deferredPrompt = null;
      } catch (error) {
        console.error('‚ùå Errore installazione PWA:', error);
      }
    }
    
    // Rileva se app √® gi√† installata
    window.addEventListener('appinstalled', () => {
      console.log('‚úÖ PWA installata con successo!');
      if (installButton) {
        installButton.style.display = 'none';
      }
      deferredPrompt = null;
    });
    
    // === PWA OFFLINE/ONLINE STATUS ===
    
    // Aggiorna indicatore online/offline
    function updateOnlineStatus() {
      const indicator = document.querySelector('.online-indicator');
      const status = document.querySelector('.app-status span:nth-child(2)');
      
      if (navigator.onLine) {
        indicator.style.background = '#22c55e'; // Verde
        status.textContent = 'Online';
      } else {
        indicator.style.background = '#ef4444'; // Rosso
        status.textContent = 'Offline';
      }
    }
    
    // Ascolta cambi di stato rete
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    
    // Inizializza stato
    updateOnlineStatus();
    
  </script>
  
</body>
</html>